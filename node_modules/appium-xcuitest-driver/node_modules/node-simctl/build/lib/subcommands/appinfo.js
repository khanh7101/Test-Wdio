"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.appInfo = appInfo;
const helpers_1 = require("../helpers");
const lodash_1 = __importDefault(require("lodash"));
/**
 * Get information about an app installed on the simulator
 *
 * @param bundleId - Bundle identifier of the application
 * @return App info object
 * @throws {Error} If the app is not found
 * @throws {Error} If the corresponding simctl subcommand command
 *                 returns non-zero return code.
 * @throws {Error} If the `udid` instance property is unset
 */
async function appInfo(bundleId) {
    const { stdout } = await this.exec('appinfo', {
        args: [this.requireUdid('appinfo'), bundleId],
    });
    let result;
    try {
        result = JSON.parse(stdout);
    }
    catch {
        // If JSON parsing fails, use plutil to convert plist-style output to JSON
        try {
            result = await (0, helpers_1.convertPlistToJson)(stdout);
        }
        catch (err) {
            throw new Error(`Cannot retrieve app info for ${bundleId}: ${err instanceof Error ? err.message : String(err)}`);
        }
    }
    if (!lodash_1.default.isPlainObject(result) || !('ApplicationType' in result)) {
        throw new Error(`App with bundle identifier "${bundleId}" not found. Is it installed?`);
    }
    return result;
}
//# sourceMappingURL=appinfo.js.map