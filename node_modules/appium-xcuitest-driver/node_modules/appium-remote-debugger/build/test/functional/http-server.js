"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.startHttpServer = startHttpServer;
exports.stopHttpServer = stopHttpServer;
const node_http_1 = __importDefault(require("node:http"));
const bluebird_1 = __importDefault(require("bluebird"));
const support_1 = require("@appium/support");
const finalhandler_1 = __importDefault(require("finalhandler"));
const serve_static_1 = __importDefault(require("serve-static"));
const node_path_1 = __importDefault(require("node:path"));
const serve = (0, serve_static_1.default)(node_path_1.default.resolve('test', 'functional', 'html'));
const log = support_1.logger.getLogger('TestHttpServer');
const PORT = 1234;
let server;
async function startHttpServer(port = PORT) {
    // start a simple http server to serve pages (so no interwebs needed)
    server = node_http_1.default.createServer(function requestHandler(req, res) {
        log.debug(`${req.method} ${req.url}`);
        serve(req, res, (0, finalhandler_1.default)(req, res));
    });
    await bluebird_1.default.promisify(server.listen, { context: server })(PORT);
    log.debug(`HTTP server listening on port '${port}'`);
    return port;
}
function stopHttpServer() {
    if (server) {
        server.close();
    }
}
//# sourceMappingURL=http-server.js.map